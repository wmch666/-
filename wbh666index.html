<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¸­åå¤©è±¡æ¼”ç¤º (æ‰‹æœºç‰ˆ)</title>
    <style>
        /* --- å…¨å±€è®¾ç½® --- */
        :root {
            --bg-color: #050505;
            --panel-bg: rgba(20, 20, 35, 0.95);
            --accent-gold: #ffd700;
            --accent-red: #ff4757;
            --text-main: #e0e0e0;
            
            /* å››è±¡è‰² */
            --dragon: #00ff88; 
            --bird: #ff4d4d;   
            --tiger: #e0e0e0;  
            --tortoise: #00bfff; 
        }

        body {
            margin: 0;
            height: 100vh;
            width: 100vw;
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Microsoft YaHei", sans-serif;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            /* åŠ¨æ€æ˜Ÿç©ºèƒŒæ™¯ */
            background-image: 
                radial-gradient(white, rgba(255,255,255,.2) 2px, transparent 3px),
                radial-gradient(white, rgba(255,255,255,.15) 1px, transparent 2px);
            background-size: 550px 550px, 350px 350px;
        }

        /* --- é¡¶éƒ¨å¯¼èˆª (Tab) --- */
        .main-nav {
            flex: 0 0 45px;
            background: rgba(30,30,40,0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-around; /* æ‰‹æœºç«¯å¹³å‡åˆ†å¸ƒ */
            align-items: center;
            z-index: 1000;
        }

        .nav-btn {
            flex: 1;
            background: transparent;
            border: none;
            color: #888;
            font-size: 0.95rem;
            height: 100%;
            cursor: pointer;
            position: relative;
            transition: 0.3s;
            font-weight: bold;
        }

        .nav-btn.active { color: var(--accent-gold); background: rgba(255,255,255,0.05); }
        .nav-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0; left: 50%; transform: translateX(-50%);
            width: 40%; height: 3px;
            background: var(--accent-gold);
            border-radius: 2px 2px 0 0;
        }

        /* --- è§†å›¾å®¹å™¨ --- */
        .view-container {
            flex: 1;
            position: relative;
            width: 100%;
            height: 100%;
            display: none;
            overflow: hidden;
        }
        .view-container.active-view {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* =========================================
           è§†å›¾1ï¼šå¤©é“è¿è¡Œ (æ‰‹æœºä¼˜åŒ–ç‰ˆ)
           ========================================= */
        #view-motion .hud-panel {
            position: absolute;
            top: 15px;
            background: var(--panel-bg);
            border: 1px solid rgba(255,255,255,0.15);
            padding: 10px 20px;
            border-radius: 12px;
            text-align: center;
            z-index: 100;
            box-shadow: 0 4px 15px rgba(0,0,0,0.6);
            width: 80%;
            max-width: 300px;
        }
        #view-motion .hud-title { font-size: 1.3rem; margin: 0 0 5px 0; letter-spacing: 2px; }
        #view-motion .hud-sub { font-size: 0.9rem; color: #bbb; display: flex; gap: 15px; justify-content: center; }
        #view-motion .val-red { color: var(--accent-red); font-weight: bold; font-size: 1.1rem; }
        #view-motion .val-gold { color: var(--accent-gold); font-weight: bold; font-size: 1.1rem; }

        #view-motion .universe {
            position: relative;
            width: 600px; height: 600px; /* åŸå§‹å°ºå¯¸ */
            border-radius: 50%;
            border: 1px dashed rgba(255, 255, 255, 0.1);
            display: flex; justify-content: center; align-items: center;
            
            /* æ ¸å¿ƒç¼©æ”¾ï¼šæ‰‹æœºå±å¹•ä¸Šå¼ºåˆ¶ç¼©å° */
            transform: scale(0.55); 
        }
        
        /* é€‚é…ç¨å¤§ä¸€ç‚¹çš„æ‰‹æœº */
        @media (min-width: 380px) { #view-motion .universe { transform: scale(0.6); } }
        @media (min-width: 700px) { #view-motion .universe { transform: scale(0.9); } }

        #view-motion .zodiac-mark {
            position: absolute; font-size: 1.3rem; color: #555; font-weight: bold;
            transition: 0.3s;
        }
        #view-motion .zodiac-mark.active-jian { color: var(--accent-red); text-shadow: 0 0 15px var(--accent-red); transform: scale(1.6); }
        #view-motion .zodiac-mark.active-jiang { color: var(--accent-gold); text-shadow: 0 0 15px var(--accent-gold); transform: scale(1.6); }

        #view-motion .earth {
            width: 60px; height: 60px;
            background: radial-gradient(circle at 30% 30%, #2980b9, #000);
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(41, 128, 185, 0.6);
        }

        #view-motion .dipper-wrapper { position: absolute; width: 100%; height: 100%; pointer-events: none; z-index: 40; }
        #view-motion .dipper-svg {
            position: absolute; top: 50%; left: 50%;
            width: 340px; height: 170px; /* ç•¥å¾®æ”¾å¤§SVGä»¥é€‚åº” */
            transform: translate(0, -50%); transform-origin: 0% 50%;
        }

        #view-motion .sun-wrapper { position: absolute; width: 100%; height: 100%; pointer-events: none; z-index: 30; }
        #view-motion .sun {
            position: absolute; right: 15px; top: 50%; margin-top: -25px;
            width: 50px; height: 50px;
            background: radial-gradient(circle, #fff, var(--accent-gold));
            border-radius: 50%; box-shadow: 0 0 40px var(--accent-gold);
        }

        #view-motion .controls {
            position: absolute; bottom: 40px;
            background: rgba(40,40,50,0.9);
            padding: 10px 25px;
            border-radius: 30px;
            display: flex; gap: 20px;
            backdrop-filter: blur(5px);
            z-index: 100;
            border: 1px solid rgba(255,255,255,0.1);
        }
        #view-motion .ctrl-btn {
            background: transparent; border: 1px solid #aaa; color: #fff;
            width: 44px; height: 44px; border-radius: 50%;
            cursor: pointer; font-size: 1.4rem;
            display: flex; align-items: center; justify-content: center;
        }

        /* =========================================
           è§†å›¾2ï¼šæ˜Ÿå®¿å¤©è±¡ (æ‰‹æœºä¼˜åŒ–ç‰ˆ)
           ========================================= */
        #view-stars .header-bar {
            position: absolute; top: 10px; left: 0; width: 100%;
            z-index: 100; display: flex; justify-content: center; gap: 10px;
            pointer-events: none;
        }
        #view-stars .era-controls {
            pointer-events: auto; background: rgba(0,0,0,0.6);
            padding: 4px; border-radius: 20px; backdrop-filter: blur(4px);
        }
        #view-stars .era-btn {
            background: transparent; border: 1px solid #555; color: #aaa;
            padding: 6px 12px; cursor: pointer; border-radius: 20px;
            margin: 0 3px; font-size: 0.85rem;
        }
        #view-stars .era-btn.active {
            background: var(--accent-gold); color: #000; border-color: var(--accent-gold); font-weight: bold;
        }

        #view-stars .stage {
            position: relative; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
            overflow: hidden;
        }

        /* æ–¹ä½èƒŒæ™¯å­— */
        #view-stars .dir-label {
            position: absolute; font-size: 3rem; font-weight: bold;
            opacity: 0.1; color: #fff; z-index: 0;
        }
        .dir-s { top: 8%; left: 50%; transform: translateX(-50%); }
        .dir-n { bottom: 22%; left: 50%; transform: translateX(-50%); }
        .dir-e { left: 2%; top: 45%; transform: translateY(-50%); }
        .dir-w { right: 2%; top: 45%; transform: translateY(-50%); }

        #view-stars .sky-disc-container {
            position: absolute;
            width: 680px; height: 680px;
            border-radius: 50%;
            transition: transform 1s ease;
            transform-origin: center center;
            
            /* æ ¸å¿ƒç¼©æ”¾ï¼šæ‰‹æœºé€‚é… */
            transform: scale(0.5); 
            top: 42%; /* ç¨å¾®å‘ä¸Šæä¸€ç‚¹ï¼Œç•™ç»™åº•éƒ¨æŒ‰é’® */
            left: 50%; margin-left: -340px; margin-top: -340px;
        }
        
        @media (min-width: 380px) { #view-stars .sky-disc-container { transform: scale(0.55); } }
        @media (min-width: 700px) { #view-stars .sky-disc-container { transform: scale(0.8); } }

        #view-stars .orbit-ring {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); border-radius: 50%;
            border: 1px solid rgba(255,255,255,0.08); pointer-events: none;
        }
        .ring-1 { width: 260px; height: 260px; }
        .ring-2 { width: 380px; height: 380px; }
        .ring-3 { width: 500px; height: 500px; }
        .ring-4 { width: 640px; height: 640px; border-style: dashed; }

        #view-stars .spoke {
            position: absolute; top: 50%; left: 50%;
            width: 48%; height: 1px;
            background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.1) 100%);
            transform-origin: 0 0; z-index: 1;
        }

        #view-stars .sky-label { position: absolute; display: flex; justify-content: center; align-items: center; }
        
        .highlight-group .branch-pill { 
            background: var(--accent-gold) !important; color: #000 !important; 
            box-shadow: 0 0 20px var(--accent-gold); transform: scale(1.3); 
        }
        .highlight-group .term-txt { color: var(--accent-gold) !important; font-weight: bold; font-size: 1rem; }
        .highlight-group .star-txt { color: #fff !important; font-weight: bold; text-shadow: 0 0 10px currentColor; font-size: 1.2rem; }
        .highlight-group .part-txt { opacity: 1 !important; font-weight: bold; color: var(--accent-gold) !important; }

        .term-txt { font-size: 0.9rem; color: #777; width: 60px; text-align: center; }
        .branch-pill {
            width: 34px; height: 34px; line-height: 34px;
            border-radius: 50%; background: #1a1a1a; border: 1px solid #333;
            font-size: 1.2rem; font-weight: bold; z-index: 10; text-align: center;
        }
        .part-txt { font-size: 0.8rem; opacity: 0.6; white-space: nowrap; }
        .star-txt { font-size: 1rem; }

        #view-stars .center-dipper-layer {
            position: absolute; width: 300px; height: 300px;
            top: 42%; left: 50%; margin-top: -150px; margin-left: -150px;
            pointer-events: none; z-index: 50;
            transition: transform 0.8s ease-in-out;
            transform: scale(0.8); /* æ‰‹æœºä¸ŠåŒ—æ–—ä¹Ÿç¨å¾®å°ä¸€ç‚¹ */
        }

        #view-stars .polaris-star {
            position: absolute; top: 42%; left: 50%;
            width: 8px; height: 8px; background: #fff; border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 20px #fff, 0 0 40px var(--accent-gold);
            z-index: 60;
        }

        /* åº•éƒ¨äº¤äº’é¢æ¿ */
        #view-stars .bottom-panel {
            position: absolute; bottom: 0; width: 100%;
            z-index: 100; background: var(--panel-bg);
            padding: 10px 0 20px 0; 
            border-top: 1px solid #333;
            display: flex; flex-direction: column; align-items: center;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
        }
        #view-stars .info-text { text-align: center; margin-bottom: 8px; font-size: 1rem; min-height: 1.5em; padding: 0 10px; }
        #view-stars .val-highlight { color: var(--accent-gold); font-weight: bold; font-size: 1.2rem; margin: 0 4px; }
        
        #view-stars .month-selector {
            display: grid; grid-template-columns: repeat(6, 1fr); /* æ‰‹æœºä¸Šåˆ†ä¸¤è¡Œ */
            gap: 3px;
            width: 96%;
        }
        #view-stars .m-btn {
            background: rgba(255,255,255,0.05); color: #888;
            text-align: center; padding: 8px 0; font-size: 0.85rem;
            cursor: pointer; border-radius: 4px; 
            border-bottom: 2px solid transparent;
        }
        #view-stars .m-btn span { display: block; font-size: 0.65rem; opacity: 0.6; margin-top: 1px; }
        #view-stars .m-btn.active { 
            background: rgba(255,215,0,0.15); color: var(--accent-gold); 
            border-bottom-color: var(--accent-gold); 
        }

        /* è¾…åŠ©é¢œè‰² */
        .c-dragon { color: var(--dragon); } .bg-dragon { border-color: var(--dragon); color: var(--dragon); }
        .c-bird { color: var(--bird); } .bg-bird { border-color: var(--bird); color: var(--bird); }
        .c-tiger { color: var(--tiger); } .bg-tiger { border-color: var(--tiger); color: var(--tiger); }
        .c-tortoise { color: var(--tortoise); } .bg-tortoise { border-color: var(--tortoise); color: var(--tortoise); }

    </style>
</head>
<body>

    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <nav class="main-nav">
        <button class="nav-btn active" onclick="switchTab('view-motion')">è¿è¡Œè½¨è¿¹ (åŠ¨æ€)</button>
        <button class="nav-btn" onclick="switchTab('view-stars')">æ˜Ÿå®¿å¤©è±¡ (æŸ¥é˜…)</button>
    </nav>

    <!-- ================================================== -->
    <!-- è§†å›¾ 1: æœˆå»ºæœˆå°†çš„è¿åŠ¨è½¨è¿¹ -->
    <!-- ================================================== -->
    <div id="view-motion" class="view-container active-view">
        
        <div class="hud-panel">
            <h2 class="hud-title" id="vm-mainTitle">å¯…æœˆ (æ­£æœˆ)</h2>
            <div class="hud-sub">
                <span>æ–—æŸ„æŒ‡ï¼š<span class="val-red" id="vm-txtJian">å¯…</span></span>
                <span>å¤ªé˜³åœ¨ï¼š<span class="val-gold" id="vm-txtJiang">äº¥</span></span>
            </div>
        </div>

        <div class="universe" id="vm-universe">
            <!-- åœ°çƒ -->
            <div class="earth-group"><div class="earth"></div></div>

            <!-- æ–—æŸ„å±‚ -->
            <div class="dipper-wrapper" id="vm-dipperLayer">
                <svg class="dipper-svg" viewBox="0 0 300 150">
                    <path d="M20,50 L60,80 L100,70 L120,40 L100,70 L100,110 L60,120 L60,80" stroke="rgba(255,255,255,0.3)" stroke-width="2" fill="none" />
                    <line x1="120" y1="40" x2="280" y2="40" stroke="#ff4757" stroke-width="2" stroke-dasharray="5,3" style="opacity:0.6" />
                    <circle cx="20" cy="50" r="3" fill="#fff" />
                    <circle cx="60" cy="80" r="3" fill="#fff" />
                    <circle cx="60" cy="120" r="3" fill="#fff" />
                    <circle cx="100" cy="110" r="3" fill="#fff" />
                    <circle cx="100" cy="70" r="3" fill="#fff" />
                    <circle cx="130" cy="55" r="3" fill="#fff" />
                    <circle cx="160" cy="40" r="6" fill="#ff4757" style="filter: drop-shadow(0 0 5px red);" />
                </svg>
            </div>

            <!-- å¤ªé˜³å±‚ -->
            <div class="sun-wrapper" id="vm-sunLayer">
                <div class="sun"></div>
            </div>
            <!-- JSç”Ÿæˆåˆ»åº¦ -->
        </div>

        <div class="controls">
            <button class="ctrl-btn" onclick="vm_togglePlay()" id="vm-btnPlay">â¸</button>
            <button class="ctrl-btn" onclick="vm_changeSpeed(0.5)">ğŸ¢</button>
            <button class="ctrl-btn" onclick="vm_changeSpeed(2)">ğŸš€</button>
        </div>
    </div>

    <!-- ================================================== -->
    <!-- è§†å›¾ 2: åäºŒåœ°æ”¯å’ŒäºŒåå…«æ˜Ÿå®¿ -->
    <!-- ================================================== -->
    <div id="view-stars" class="view-container">
        
        <div class="header-bar">
            <div class="era-controls">
                <button class="era-btn" onclick="vs_setEra('ancient')" id="vs-btn-ancient">ä¸Šå¤ (å°§èˆœç¦¹)</button>
                <button class="era-btn active" onclick="vs_setEra('modern')" id="vs-btn-modern">ç°ä»£ (2025)</button>
            </div>
        </div>

        <div class="stage">
            <div class="compass-bg">
                <div class="dir-label dir-s">å—</div>
                <div class="dir-label dir-n">åŒ—</div>
                <div class="dir-label dir-e">ä¸œ</div>
                <div class="dir-label dir-w">è¥¿</div>
            </div>

            <!-- æ—‹è½¬å¤©ç›˜ -->
            <div class="sky-disc-container" id="vs-skyDisc">
                <div class="orbit-ring ring-1"></div>
                <div class="orbit-ring ring-2"></div>
                <div class="orbit-ring ring-3"></div>
                <div class="orbit-ring ring-4"></div>
            </div>

            <!-- ä¸­å¿ƒåŒ—æ–— -->
            <div class="center-dipper-layer" id="vs-dipperLayer">
                <svg width="100%" height="100%" viewBox="0 0 200 200" style="filter: drop-shadow(0 0 5px rgba(255,215,0,0.4));">
                    <g>
                        <polyline points="85,90 115,90 115,110 85,110 85,90" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="1" />
                        <line x1="115" y1="90" x2="115" y2="20" stroke="var(--accent-gold)" stroke-width="3" stroke-linecap="round" />
                        <line x1="115" y1="20" x2="115" y2="-50" stroke="red" stroke-width="2" stroke-dasharray="5,5" opacity="0.6" />
                        <circle cx="85" cy="90" r="3" fill="#fff" />
                        <circle cx="115" cy="90" r="3" fill="#fff" />
                        <circle cx="85" cy="110" r="3" fill="#fff" />
                        <circle cx="115" cy="110" r="3" fill="#fff" />
                        <circle cx="115" cy="65" r="3.5" fill="#fff" />
                        <circle cx="115" cy="40" r="3.5" fill="#fff" />
                        <circle cx="115" cy="20" r="5" fill="var(--accent-gold)" /> 
                    </g>
                </svg>
            </div>

            <div class="polaris-star"></div>
        </div>

        <div class="bottom-panel">
            <div class="info-text" id="vs-infoText"></div>
            <div class="month-selector" id="vs-monthGrid"></div>
        </div>
    </div>

    <script>
        // -------------------------------------
        // æ ¸å¿ƒæ§åˆ¶é€»è¾‘
        // -------------------------------------
        
        function switchTab(tabId) {
            document.querySelectorAll('.view-container').forEach(el => el.classList.remove('active-view'));
            document.getElementById(tabId).classList.add('active-view');
            
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            if(tabId === 'view-motion') document.querySelector('.nav-btn:nth-child(1)').classList.add('active');
            else document.querySelector('.nav-btn:nth-child(2)').classList.add('active');

            if(tabId === 'view-motion') {
                vm_isPlaying = true; vm_animate();
            } else {
                vm_isPlaying = false;
            }
        }

        // --- æ¨¡å— 1: åŠ¨æ€æ¼”ç¤º ---
        const vm_branches = ['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥'];
        let vm_currentAngle = 150;
        let vm_isPlaying = true;
        let vm_speed = 0.2;
        let vm_animId;

        const vm_universe = document.getElementById('vm-universe');
        const vm_dipperLayer = document.getElementById('vm-dipperLayer');
        const vm_sunLayer = document.getElementById('vm-sunLayer');
        const vm_mainTitle = document.getElementById('vm-mainTitle');
        const vm_txtJian = document.getElementById('vm-txtJian');
        const vm_txtJiang = document.getElementById('vm-txtJiang');
        const vm_btnPlay = document.getElementById('vm-btnPlay');

        function vm_init() {
            const radius = 265;
            vm_branches.forEach((b, i) => {
                const div = document.createElement('div');
                div.className = 'zodiac-mark';
                div.innerText = b;
                div.id = `vm-mk-${i}`;
                const deg = 90 + (i * 30);
                const rad = deg * (Math.PI / 180);
                const x = Math.cos(rad) * radius;
                const y = Math.sin(rad) * radius;
                div.style.transform = `translate(${x}px, ${y}px)`;
                vm_universe.appendChild(div);
            });
            vm_animate();
        }

        function vm_animate() {
            if (!vm_isPlaying) return;
            vm_currentAngle += vm_speed;
            vm_updateView(vm_currentAngle);
            vm_animId = requestAnimationFrame(vm_animate);
        }

        function vm_updateView(angle) {
            vm_dipperLayer.style.transform = `rotate(${angle}deg)`;
            const sunRot = 210 - angle;
            vm_sunLayer.style.transform = `rotate(${sunRot}deg)`;

            let normAngle = angle % 360;
            if (normAngle < 0) normAngle += 360;
            let calcAngle = normAngle - 75;
            if (calcAngle < 0) calcAngle += 360;
            
            let jianIndex = Math.floor(calcAngle / 30);
            if (jianIndex >= 12) jianIndex = 0;
            let jiangIndex = (13 - jianIndex) % 12;

            if (vm_txtJian.getAttribute('data-v') != jianIndex) {
                vm_txtJian.setAttribute('data-v', jianIndex);
                vm_txtJian.innerText = vm_branches[jianIndex];
                vm_txtJiang.innerText = vm_branches[jiangIndex];
                vm_mainTitle.innerText = `${vm_branches[jianIndex]}æœˆ`;

                document.querySelectorAll('#view-motion .zodiac-mark').forEach(el => {
                    el.classList.remove('active-jian', 'active-jiang');
                });
                document.getElementById(`vm-mk-${jianIndex}`).classList.add('active-jian');
                document.getElementById(`vm-mk-${jiangIndex}`).classList.add('active-jiang');
            }
        }

        function vm_togglePlay() {
            vm_isPlaying = !vm_isPlaying;
            vm_btnPlay.innerText = vm_isPlaying ? "â¸" : "â–¶";
            if (vm_isPlaying) vm_animate();
        }

        function vm_changeSpeed(factor) {
            if (factor > 1 && vm_speed < 5) vm_speed *= 1.5;
            if (factor < 1 && vm_speed > 0.05) vm_speed *= 0.7;
        }

        // --- æ¨¡å— 2: æ˜Ÿå®¿æŸ¥é˜… ---
        const vs_branchesData = [
            { name: 'åˆ', month: 'äº”æœˆ', color: 'bird', part: 'é¸Ÿèº«', stars: ['æŸ³','æ˜Ÿ','å¼ '], terms: ['èŠ’ç§','å¤è‡³'] },
            { name: 'æœª', month: 'å…­æœˆ', color: 'bird', part: 'é¸Ÿå¤´', stars: ['äº•','é¬¼'], terms: ['å°æš‘','å¤§æš‘'] },
            { name: 'ç”³', month: 'ä¸ƒæœˆ', color: 'tiger', part: 'è™å°¾', stars: ['è§œ','å‚'], terms: ['ç«‹ç§‹','å¤„æš‘'] },
            { name: 'é…‰', month: 'å…«æœˆ', color: 'tiger', part: 'è™èº«', stars: ['èƒƒ','æ˜´','æ¯•'], terms: ['ç™½éœ²','ç§‹åˆ†'] },
            { name: 'æˆŒ', month: 'ä¹æœˆ', color: 'tiger', part: 'è™å¤´', stars: ['å¥','å¨„'], terms: ['å¯’éœ²','éœœé™'] },
            { name: 'äº¥', month: 'åæœˆ', color: 'tortoise', part: 'é¾Ÿå°¾', stars: ['å®¤','å£'], terms: ['ç«‹å†¬','å°é›ª'] },
            { name: 'å­', month: 'å†¬æœˆ', color: 'tortoise', part: 'é¾Ÿèº«', stars: ['å¥³','è™š','å±'], terms: ['å¤§é›ª','å†¬è‡³'] },
            { name: 'ä¸‘', month: 'è…Šæœˆ', color: 'tortoise', part: 'é¾Ÿå¤´', stars: ['æ–—','ç‰›'], terms: ['å°å¯’','å¤§å¯’'] },
            { name: 'å¯…', month: 'æ­£æœˆ', color: 'dragon', part: 'é¾™å°¾', stars: ['å°¾','ç®•'], terms: ['ç«‹æ˜¥','é›¨æ°´'] },
            { name: 'å¯', month: 'äºŒæœˆ', color: 'dragon', part: 'é¾™èº«', stars: ['æ°','æˆ¿','å¿ƒ'], terms: ['æƒŠè›°','æ˜¥åˆ†'] },
            { name: 'è¾°', month: 'ä¸‰æœˆ', color: 'dragon', part: 'é¾™å¤´', stars: ['è§’','äº¢'], terms: ['æ¸…æ˜','è°·é›¨'] },
            { name: 'å·³', month: 'å››æœˆ', color: 'bird', part: 'é¸Ÿå°¾', stars: ['ç¿¼','è½¸'], terms: ['ç«‹å¤','å°æ»¡'] }
        ];
        
        const vs_renderOrder = [8, 9, 10, 11, 0, 1, 2, 3, 4, 5, 6, 7];
        let vs_currentEra = 'modern';
        let vs_currentIdx = 9;

        const vs_skyDisc = document.getElementById('vs-skyDisc');
        const vs_dipperLayer = document.getElementById('vs-dipperLayer');
        const vs_infoText = document.getElementById('vs-infoText');
        const vs_monthGrid = document.getElementById('vs-monthGrid');

        function vs_init() {
            const r_term = 330;
            const r_branch = 250;
            const r_part = 190;
            const r_star = 130;

            vs_branchesData.forEach((b, i) => {
                const deg = i * 30;
                const group = document.createElement('div');
                group.id = `vs-group-${i}`;
                vs_skyDisc.appendChild(group);

                const getPos = (r, offset=0) => {
                    const rad = (deg + offset - 90) * (Math.PI / 180);
                    return { x: Math.cos(rad)*r + 340, y: Math.sin(rad)*r + 340 };
                };

                const spoke = document.createElement('div');
                spoke.className = 'spoke';
                spoke.style.transform = `rotate(${deg - 90}deg)`;
                vs_skyDisc.appendChild(spoke);

                b.terms.forEach((t, ti) => {
                    const offset = ti===0 ? -7 : 7;
                    const p = getPos(r_term, offset);
                    const el = document.createElement('div');
                    el.className = 'sky-label term-txt';
                    el.innerText = t;
                    el.style.left = (p.x-30)+'px'; el.style.top = (p.y-10)+'px';
                    el.style.transform = `rotate(${deg+offset}deg)`;
                    group.appendChild(el);
                });

                const pB = getPos(r_branch);
                const elB = document.createElement('div');
                elB.className = `sky-label branch-pill bg-${b.color}`;
                elB.innerText = b.name;
                elB.style.left = (pB.x-17)+'px'; elB.style.top = (pB.y-17)+'px';
                group.appendChild(elB);

                const pPartReal = getPos(r_part);
                const elP = document.createElement('div');
                elP.className = `sky-label part-txt c-${b.color}`;
                elP.innerText = b.part;
                elP.style.left = (pPartReal.x-20)+'px'; elP.style.top = (pPartReal.y-10)+'px';
                elP.style.transform = `rotate(${deg}deg)`;
                group.appendChild(elP);

                b.stars.forEach((s, si) => {
                    const offset = (si - (b.stars.length-1)/2) * 9;
                    const pS = getPos(r_star, offset);
                    const elS = document.createElement('div');
                    elS.className = `sky-label star-txt c-${b.color}`;
                    elS.innerText = s;
                    elS.style.left = (pS.x-10)+'px'; elS.style.top = (pS.y-10)+'px';
                    group.appendChild(elS);
                });
            });

            vs_renderOrder.forEach(idx => {
                const b = vs_branchesData[idx];
                const btn = document.createElement('div');
                btn.className = `m-btn`;
                btn.id = `vs-btn-${idx}`;
                btn.onclick = () => vs_selectMonth(idx);
                btn.innerHTML = `${b.name}æœˆ<span>${b.terms[0]}</span>`;
                vs_monthGrid.appendChild(btn);
            });

            vs_updateView();
        }

        function vs_updateView() {
            // æ–—æŸ„æ—‹è½¬
            const deg = vs_currentIdx * 30;
            vs_dipperLayer.style.transform = `scale(0.8) rotate(${deg}deg)`;

            // å¤©ç›˜æ—‹è½¬
            const k = vs_currentEra === 'modern' ? 11 : 9;
            const targetIdx = (k - vs_currentIdx + 12) % 12;
            
            // æ ¸å¿ƒä¿®å¤ï¼šæ‰‹æœºç«¯é™¤äº†æ—‹è½¬è¿˜éœ€è¦ä¿æŒscale
            // æ£€æµ‹æ˜¯å¦æ˜¯æ‰‹æœº(ç®€å•åˆ¤æ–­)
            let scale = 0.5;
            if(window.innerWidth > 380) scale = 0.55;
            if(window.innerWidth > 700) scale = 0.8;
            
            vs_skyDisc.style.transform = `scale(${scale}) rotate(${-targetIdx * 30}deg)`;

            for(let i=0; i<12; i++) {
                document.getElementById(`vs-group-${i}`).classList.remove('highlight-group');
            }
            document.getElementById(`vs-group-${targetIdx}`).classList.add('highlight-group');

            const b = vs_branchesData[vs_currentIdx];
            const t = vs_branchesData[targetIdx];
            const eraTxt = vs_currentEra === 'modern' ? 'ç°ä»£ (2025)' : 'ä¸Šå¤ (å°§èˆœç¦¹)';
            
            vs_infoText.innerHTML = `
                <span style="color:#888; font-size:0.85rem">${eraTxt} Â· é»„æ˜è§‚æµ‹</span><br>
                <span class="val-highlight">${b.name}æœˆ</span>
                <span style="margin:0 5px; color:#444">|</span>
                æ­£å—å€¼æ—¥ï¼š<span class="val-highlight" style="color:var(--${t.color})">${t.stars.join('')}</span>
            `;

            document.querySelectorAll('#view-stars .m-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`vs-btn-${vs_currentIdx}`).classList.add('active');
        }

        function vs_selectMonth(idx) { vs_currentIdx = idx; vs_updateView(); }
        function vs_setEra(e) { 
            vs_currentEra = e; 
            document.getElementById('vs-btn-ancient').classList.remove('active');
            document.getElementById('vs-btn-modern').classList.remove('active');
            document.getElementById(`vs-btn-${e}`).classList.add('active');
            vs_updateView();
        }

        // å¯åŠ¨
        vm_init();
        vs_init();
    </script>
</body>
</html>
